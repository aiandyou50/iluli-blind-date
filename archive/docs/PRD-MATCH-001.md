
-----

# [PRD-MATCH-001] 매칭 로직 및 카드 UI

**문서 버전:** **1.1** (채팅 대신 인스타 DM 연결) | **작성일:** 2025-11-16 | **작성자:** 이루리 (AI)
**Epic:** `EPIC-003` (매칭) | ...

## 1\. 개요

  - **User Story**:

    1.  (탐색) "사용자로서, '승인된' 프로필을 가진 다른 사용자들을 '매칭 카드' 형태로... 'OK' 또는 'Pass'로 내 의사를 효율적으로 표현하고 싶다."
    2.  **(매칭) [v1.1 수정]** "내가 'OK'를 보낸 상대방도 나에게 'OK'를 보냈을 때(상호 'OK'), **'매치'가 성사**되어 알림을 받고, 상대방의 **'인스타그램'으로 이동**해 DM으로 대화를 시작하고 싶다."

  - **Acceptance Criteria (Gherkin Format)**:

<!-- end list -->

```gherkin
Feature: 매칭 카드 탐색 및 매치 성사
  ... (시나리오: 덱 로드, OK(대기), Pass - v1.0과 동일) ...

  시나리오: 사용자가 'OK'를 보내고 '매치'가 성사된다. [v1.1 수정]
    Given 나는 '사용자 B'의 카드를 보고 있다.
    And '사용자 B'는 과거에 이미 나에게 'OK'를 보낸 상태이다.
    And '사용자 B'는 `instagram_url`을 등록했다.
    When 내가 '사용자 B'의 카드에 'OK' 버튼을 클릭한다.
    Then 시스템은 '상호 OK'를 감지하고 '매치'를 성사시킨다.
    And 나에게 즉시 "매치 성공!" 모달(Modal)이 표시되어야 한다.
    And "매치 성공!" 모달에는 **"인스타그램으로 DM 보내기" 버튼**이 포함되어야 한다.
    And 이 버튼은 '사용자 B'의 인스타그램 URL (`UserProfiles.instagram_url`)로 연결되어야 한다.

  시나리오: 매치된 상대방이 인스타그램을 등록하지 않았을 경우 [v1.1 추가]
    Given 나는 '사용자 C'와 매치가 성사되었다.
    And '사용자 C'는 `instagram_url`이 'NULL'이다.
    When "매치 성공!" 모달이 표시된다.
    Then "인스타그램으로 DM 보내기" 버튼은 **비활성화**되거나 **"상대방이 인스타그램을 등록하지 않았습니다"**라는 텍스트로 대체되어야 한다.
```

## 2\. 사용자 흐름 (User Flow)

```mermaid
graph TD
    ... (G[POST API] --> K{매치 성사?}) ...
    
    K -- "Yes (상호 OK!)" --> L[매치 성공! 모달 팝업]
    L --> M{"상대방 인스타<br>URL 있음?"}
    M -- "Yes" --> N[인스타그램 DM 버튼 (활성)]
    N -- "클릭" --> O[새 탭: Instagram.com]
    M -- "No" --> P[인스타그램 DM 버튼 (비활성/숨김)]
    
    L --> I[다음 카드 표시 (E)]
```

## 3\. 상세 기능 명세

### 3.1 UI/UX 요구사항

  - **화면 목록**:
    1.  **매칭 페이지 (`/matching`)**: (v1.0과 동일)
    2.  **매칭 카드 (컴포넌트)**: (v1.0과 동일)
    3.  **액션 버튼**: (v1.0과 동일)
    4.  **매치 성공 모달 (팝업) [v1.1 수정]**:
          - `Title`: "It's a Match\!"
          - [내 프로필 사진] \<-\> [상대방 프로필 사진]
          - **`Button` (핵심 액션): "상대방 인스타그램 DM 보내기"**
              - **(활성화 조건)**: 상대방의 `instagram_url`이 `NULL`이 아닐 경우에만 활성화.
              - **(동작)**: 클릭 시 상대방의 `instagram_url`을 새 탭(`target="_blank"`)으로 연다.
              - **(비활성화 시)**: 버튼을 비활성화하고 "상대방이 인스타그램을 등록하지 않았습니다." 텍스트 표시.
          - **`Button` (보조 액션): "계속 탐색하기"** (모달 닫기)

## 7\. 의존성 및 선행 작업

  - **선행 작업 (기술)**:
      - (v1.0과 동일: 모든 PRD 스키마, D1 테이블 생성)
  - **의존성 (연계)**:
      - **[v1.1 수정]** **`PRD-CHAT-001` (채팅)**: **의존성 제거됨.**
      - **`PRD-USER-001 (프로필)`**: '매치' 기능이 정상 동작하려면 사용자들이 **`instagram_url`** 을 필수로 입력하도록 유도하는 UI/UX 정책이 강력히 권장됨. (현재 `NULLABLE`임)

-----
